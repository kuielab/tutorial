
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TF Representations and Masking &#8212; Open-Source Tools &amp; Data for Music Source Separation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Phase" href="phase.html" />
    <link rel="prev" title="Representing Audio" href="representations.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Open-Source Tools & Data for Music Source Separation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../landing.html">
   Open Source Tools &amp; Data for Music Source Separation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/tutorial_structure.html">
   Tutorial Structure and Setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/src_sep_101.html">
   What is Source Separation?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/open_src_projects.html">
   Map of Open-Source Source Separation Projects
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Basics of Source Separation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="representations.html">
   Representing Audio
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   TF Representations and Masking
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="phase.html">
   Phase
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="evaluation.html">
   Evaluation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  MDX Challenge
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mdx/mdx.html">
   MDX Challenge
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mdx/cws_presunet.html">
   CWS-PResUnet
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mdx/kuielab_mdx_net.html">
   KUIELab-MDX-Net
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mdx/demucs_pp.html">
   Demucs++
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/basics/tf_and_masking.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/source-separation/tutorial"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/source-separation/tutorial/issues/new?title=Issue%20on%20page%20%2Fbasics/tf_and_masking.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-a-mask">
   What is a Mask?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#binary-masks">
   Binary Masks
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#soft-masks-or-ratio-masks">
   Soft Masks (or Ratio Masks)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ideal-masks">
   Ideal Masks
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#next-steps">
   Next Steps
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="tf-representations-and-masking">
<h1>TF Representations and Masking<a class="headerlink" href="#tf-representations-and-masking" title="Permalink to this headline">¶</a></h1>
<p>Masking has many uses in different aspects computer science and machine
learning like language modelling and computer vision. It is also an essential
part of how many modern source separation approaches
approximate sources from a mixture. To separate a single source, a separation
approach must create a single mask. To separate multiple sources, a separation
approach must create multiple masks.</p>
<p>Masks are most commonly used with approaches
that process a TF Representation, however you could make the case that
some waveform-based deep learning architectures use masking within specific parts
of their network (for instance see these papers: <span id="id1">[<a class="reference internal" href="../zzz_refs.html#id21">LM18</a>, <a class="reference internal" href="../zzz_refs.html#id18">LM19</a>]</span>).
The content in this section, however, applies specifically to masking
TF Representations.</p>
<p>For reasons we will fully discuss in the next section, we only apply masks to the
magnitude values of a TF Representation, <em>i.e.</em>, we do no apply masks to
the phase component of an STFT.
Because of this, in this section we will focus on masks applied to a spectrogram,
where phase information is not explicitly represented.</p>
<div class="section" id="what-is-a-mask">
<h2>What is a Mask?<a class="headerlink" href="#what-is-a-mask" title="Permalink to this headline">¶</a></h2>
<div class="figure align-default" id="mask-diagram">
<img alt="Diagram of a binary mask being applied to a spectrogram" src="../_images/mask_diagram.png" />
<p class="caption"><span class="caption-number">Fig. 15 </span><span class="caption-text">A mask is a matrix with the same shape as the spectogram that is element-wise
multiplied to it to produce a source estimate. This image shows an exaggerated
binary mask that produces a source estimate. This estimate probably isn’t very
good. ¯\_(ツ)_/¯</span><a class="headerlink" href="#mask-diagram" title="Permalink to this image">¶</a></p>
</div>
<p>A mask is a matrix that is the same size as a spectrogram and contains
values in the inclusive interval <span class="math notranslate nohighlight">\([0.0, 1.0]\)</span> <a class="footnote-reference brackets" href="#fn1" id="id2">1</a>. Each value in the mask determines
what proportion of energy of the original mixture that a source contributes. In
other words, for a particular TF bin, a value of <span class="math notranslate nohighlight">\(1.0\)</span> will allow <em>all</em> of
the sound from the mixture through and a value of <span class="math notranslate nohighlight">\(0.0\)</span> will allow <em>none</em> of the sound
from the mixture through.</p>
<p>We apply a mask to the original mixture by element-wise multiplying (sometimes
called the Hadamard product<a class="footnote-reference brackets" href="#fn2" id="id3">2</a>) the mask to the spectrogram. So if a mask,
<span class="math notranslate nohighlight">\(\hat{M}_i \in [0.0, 1.0]^{T \times F}\)</span>,
represents the <span class="math notranslate nohighlight">\(i\)</span>th source, <span class="math notranslate nohighlight">\(S_i\)</span>, in a mixture represented by a magnitude spectrogram,
<span class="math notranslate nohighlight">\(|Y| \in \mathbb{R}^{T \times F}\)</span>,
we can make an estimate of the source like so:</p>
<div class="math notranslate nohighlight">
\[
S_i = \hat{M}_i \odot |Y|.
\]</div>
<p>We therefore hope that the mask we estimate <span class="math notranslate nohighlight">\(\hat{M}_i\)</span> is such that it can produce
a good estimate of source <span class="math notranslate nohighlight">\(S_i\)</span> when we apply it.</p>
<p>For a mixture with <span class="math notranslate nohighlight">\(N\)</span> sources, the element-wise sum of every mask should equal
a matrix of all ones, <span class="math notranslate nohighlight">\(J \in [1.0]^{T \times F}\)</span>, that has the same shape as the
masks (and spectrogram):</p>
<div class="math notranslate nohighlight">
\[
J = \displaystyle\sum_{i=1}^{N} \hat{M}_i.
\]</div>
<p>All this means is that combining all of our masks produces a matrix of all ones,
which when we apply to the mixture, produces the original mixture (<em>i.e.</em> it does
nothing because <span class="math notranslate nohighlight">\(1 \times a = a\)</span>).</p>
<p>This also means that we can remove Source <span class="math notranslate nohighlight">\(i\)</span> from the mix by “inverting” its mask,
<span class="math notranslate nohighlight">\(\hat{M}_i\)</span>. By “invert” here, we do <strong>not</strong> mean inverting the matrix in the
<a class="reference external" href="https://en.wikipedia.org/wiki/Invertible_matrix">traditional linear algebraic sense</a>,
but rather inverting every element individually, <em>i.e.</em>, <span class="math notranslate nohighlight">\(J - \hat{M}_i\)</span>.
For example, if a value for Source <span class="math notranslate nohighlight">\(i\)</span> in <span class="math notranslate nohighlight">\(\hat{M}_i\)</span> is <span class="math notranslate nohighlight">\(0.3\)</span>, the value of the
mask for the rest of the mix at the corresponding bin is <span class="math notranslate nohighlight">\(0.7\)</span>.</p>
</div>
<div class="section" id="binary-masks">
<span id="masks-binarymasks"></span><h2>Binary Masks<a class="headerlink" href="#binary-masks" title="Permalink to this headline">¶</a></h2>
<p>The first mask type we’ll talk about is Binary Masks. Although not used much anymore,
they can give us a good intuition about how masks work in practice.</p>
<p>As the name implies, Binary Masks are masks where the only values the entries are
allowed to take is <span class="math notranslate nohighlight">\(0.0\)</span> or <span class="math notranslate nohighlight">\(1.0\)</span>.
Because all of the masks for the mixture element-wise sum up to a matrix of ones,
a Binary Mask, therefore, makes the assumption
that any TF bin is only dominated by exactly one source in the mixture.
In the literature, this assumption is called W-disjoint orthogonality.</p>
<p>While Binary Masks are not used as much to produce final source estimates anymore,
they are still useful as training targets, especially with neural network models like
Deep Clustering, which we will discuss later in this tutorial.</p>
</div>
<div class="section" id="soft-masks-or-ratio-masks">
<span id="masks-softmasks"></span><h2>Soft Masks (or Ratio Masks)<a class="headerlink" href="#soft-masks-or-ratio-masks" title="Permalink to this headline">¶</a></h2>
<p>Soft Masks are allowed to take any value within the inclusive interval <span class="math notranslate nohighlight">\([0.0, 1.0]\)</span>,
which means that instead of assigning <em>all</em> of the energy from the mix to a
source, it only assigns <em>part</em> of the mix’s energy to a source. This means that
the energy in a mix from a TF bin can be split between the sources.</p>
<p>Soft masks are more flexible than binary masks and usually lead to better
sounding results; it’s not very
often that all of the energy in a mixture can always be assigned
to one source.</p>
</div>
<div class="section" id="ideal-masks">
<h2>Ideal Masks<a class="headerlink" href="#ideal-masks" title="Permalink to this headline">¶</a></h2>
<p>As the name implies, an Ideal Mask, or Oracle Mask, represents the best possible
performance for a mask-based source separation approach.
Access to the ground truth isolated source is required in order to calculate
an Ideal Mask mask for that source. As such, it is usually used as an upper limit
on how well a source separation approach can do. Some recent waveform-based approaches
for speech separation have surpassed the performance of Ideal Masks <span id="id4">[<a class="reference internal" href="../zzz_refs.html#id18">LM19</a>]</span>.</p>
</div>
<div class="section" id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>Assuming we have a mask for our signal that we’re happy with and we’ve applied
it to our mixture signal to get an estimated magnitude spectrogram for our source,
we still have the problem of turning the estimated source magnitude spectrogram
back into audio so that we can listen to it. For that, we’ll need to understand
phase, which we will discuss in the next section…</p>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="fn1"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>When we mix waves together, it is possible that the result is the product of
<a href="https://en.wikipedia.org/wiki/Wave_interference">constructive or destructive interference.</a>
Masking as we’ve presented it here does not account for either of these phenomena,
although we do note that we are aware of some research papers <span id="id5">[<a class="reference internal" href="../zzz_refs.html#id37">CKH+18</a>, <a class="reference internal" href="../zzz_refs.html#id17">LRWW+19</a>]</span>
that specifically designs for interference.</p>
</dd>
<dt class="label" id="fn2"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>The element-wise product is notated a few different ways in the literature. For
clarity, we use <span class="math notranslate nohighlight">\(A \odot B\)</span> here, but we have also seen it expressed as <span class="math notranslate nohighlight">\(A \times B\)</span>
or <span class="math notranslate nohighlight">\(A \cdot B\)</span> for some matrices <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span>.</p>
</dd>
</dl>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "source-separation/tutorial",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./basics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="representations.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Representing Audio</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="phase.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Phase</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Alexandre Defossez, Haohe Liu, Woosung Choi, Ethan Manilow, Prem Seetharaman, Justin Salamon<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-180111316-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>